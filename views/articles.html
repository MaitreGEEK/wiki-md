<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="robots" content="noindex">
	<title>Articles - Wiki-MD</title>
	<link rel="stylesheet" href="/public/styles.css">
</head>
<body>
	<header>
		<nav>
			<a href="/" class="logo">ğŸ“š Wiki-MD</a>
			<div class="nav-links">
				<a href="/articles">Articles</a>
				{{#if logged_in}}
					<a href="/profile">Profil</a>
					{{#if is_editor}}
						<a href="/new">Nouvel article</a>
					{{/if}}
				{{/if}}
			</div>
		</nav>
	</header>

	<div class="container">
		<div class="flex-between">
			<h1>Articles</h1>
			<select id="filter" onchange="filterArticles()">
				<option value="all">Tous les articles</option>
				<option value="date">Par date</option>
				<option value="folder">Par dossier</option>
			</select>
		</div>

		<div id="articles-list" class="grid grid-2" style="margin-top: 2rem;"></div>
	</div>

	<script>
		let articles = [];
		let folders = [];

		async function loadArticles() {
			const articlesResponse = await fetch('/api/articles');
			articles = await articlesResponse.json();
			
			const foldersResponse = await fetch('/api/folders');
			folders = await foldersResponse.json();
			
			displayArticles();
		}

		function displayArticles() {
			const container = document.getElementById('articles-list');
			const filter = document.getElementById('filter').value;
			
			let sortedArticles = [...articles];
			
			if (filter === 'date') {
				sortedArticles.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
			} else if (filter === 'folder') {
				sortedArticles.sort((a, b) => (a.folder_id || 0) - (b.folder_id || 0));
			}
			
			container.innerHTML = sortedArticles.map(article => {
				const folder = folders.find(f => f.id === article.folder_id);
				return `
					<div class="card" onclick="location.href='/article/${article.slug}'">
						${article.image ? `<img src="${article.image}" alt="${article.title}" style="width:100%; border-radius: 8px; margin-bottom: 1rem;">` : ''}
						<h3>${article.title}</h3>
						<p class="article-meta">${article.description || ''}</p>
						${folder ? `<p class="article-meta">ğŸ“ ${folder.name}</p>` : ''}
						<p class="article-meta">ğŸ“… ${new Date(article.created_at).toLocaleDateString('fr-FR')}</p>
					</div>
				`;
			}).join('');
		}

		function filterArticles() {
			displayArticles();
		}

		loadArticles();
	</script>
</body>
</html>
